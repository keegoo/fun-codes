<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>文字灰烬堆积效果 + 重新生成</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 40px;
  background-color: #fafafa;
}
input {
  font-size: 32px;
  padding: 10px;
  width: 60%;
  text-align: center;
  border: 2px solid #ccc;
  border-radius: 10px;
  outline: none;
  transition: border-color 0.2s;
}
input:focus { border-color: #0078d4; }
canvas { border: 1px solid #ddd; margin-top: 30px; background-color: white; }
button {
  margin: 10px 10px 0 10px;
  padding: 10px 20px;
  font-size: 18px;
  cursor: pointer;
}
.button-container {
  margin-top: 20px;
}
</style>
</head>
<body>

<h2>文字灰烬堆积效果 👇</h2>
<input id="textInput" type="text" placeholder="输入文字…" />
<canvas id="c" width="800" height="300"></canvas>

<!-- 按钮放在 canvas 下方 -->
<div class="button-container">
  <button id="ashBtn">化成灰烬</button>
  <button id="resetBtn">重新生成文字</button>
</div>

<script>
const canvas = document.getElementById('c')
const ctx = canvas.getContext('2d')
const input = document.getElementById('textInput')
const ashBtn = document.getElementById('ashBtn')
const resetBtn = document.getElementById('resetBtn')

let particles = []
const groundY = canvas.height - 10
let columnHeights = []

function resetColumns() { columnHeights = new Array(canvas.width).fill(0) }
function drawText(text) {
  ctx.clearRect(0, 0, canvas.width, canvas.height)
  ctx.font = 'bold 80px Arial'
  ctx.fillStyle = '#000'
  ctx.textBaseline = 'middle'
  const textWidth = ctx.measureText(text).width
  const x = (canvas.width - textWidth) / 2
  const y = canvas.height / 2 + 10
  ctx.fillText(text, x, y)
}
function createParticles() {
  const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height)
  const data = imgData.data
  particles = []
  for(let y=0; y<canvas.height; y+=2){
    for(let x=0; x<canvas.width; x+=2){
      const idx = (y * canvas.width + x) * 4
      if(data[idx+3] > 0){
        particles.push({
          x: x,
          y: y,
          vy: 0,
          vx: (Math.random()-0.5)*1.5,
          settled: false
        })
      }
    }
  }
}
function animateParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height)
  for(let p of particles){
    if(!p.settled){
      p.vy += 0.5
      let nextX = p.x + p.vx
      let nextY = p.y + p.vy
      const col = Math.floor(nextX)
      const maxY = groundY - (columnHeights[col] || 0)
      if(nextY >= maxY){
        let found = false
        for(let offset=-2; offset<=2; offset++){
          const c = Math.floor(p.x + offset)
          if(c>=0 && c<canvas.width){
            const yLimit = groundY - (columnHeights[c] || 0)
            if(nextY < yLimit){
              p.x += offset
              p.y = nextY
              found = true
              break
            }
          }
        }
        if(!found){
          p.y = maxY
          p.settled = true
          columnHeights[col] += 2
        }
      } else {
        p.x = nextX
        p.y = nextY
      }
    }
    ctx.fillStyle = 'rgba(50,50,50,1)'
    ctx.fillRect(p.x, p.y, 2, 2)
  }
  if(particles.some(p=>!p.settled)) requestAnimationFrame(animateParticles)
}

input.addEventListener('input', () => {
  drawText(input.value || 'Hello')
  resetColumns()
})
ashBtn.addEventListener('click', () => {
  resetColumns()
  createParticles()
  animateParticles()
})
resetBtn.addEventListener('click', () => {
  resetColumns();
  drawText(input.value || 'Hello')
})

drawText('Hello')
resetColumns()
</script>

</body>
</html>
